{% extends "base.html" %}
{% load i18n %}

{% block title %}{% trans "Invoices" %}{% endblock %}

{% block content %}
<div class="container mt-4">

    <h5 class="text-center fw-bold text-primary">{% trans "Invoices" %}</h5>

    <!-- Filter Form: Search by Student Code or Name -->
    <form action="{% url 'invoice' %}" method="GET">
        <div class="row g-3 align-items-end">
            <!-- Code Input -->
            <div class="col-md-4">
                <label class="form-label">{% trans "Enter Code" %}</label>
                <input type="number" class="form-control" name="selected_code" value="{{ selected_code }}">
            </div>

            <!-- Name Input -->
            <div class="col-md-4">
                <label class="form-label">{% trans "Enter Name" %}</label>
                <input type="text" class="form-control" name="selected_name" value="{{ selected_name }}">
            </div>

            <!-- Submit Button -->
            <div class="col-md-4">
                <button type="submit" class="btn btn-primary w-100">{% trans "Search" %}</button>
            </div>
        </div>
    </form>
    <br>

    <!-- Display Error Message if Student Not Found -->
    {% if error_msg %}
        <div class="alert alert-danger mt-2">{{ error_msg }}</div>
    {% endif %}

    <!-- Display Invoice Form if Student is Found -->
    {% if student_data %}
        <form action="{% url 'invoice' %}" method="POST">
            {% csrf_token %}
            <input type="hidden" name="student_code" value="{{ student_data.code }}">

            <table class="table table-bordered mt-4">
                <thead class="table-light">
                    <tr>
                        <th colspan="2" class="text-center">{% trans "Student Invoice" %}</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <th style="width: 30%;">{% trans "Code ID" %}</th>
                        <td>{{ student_data.code }}</td>
                    </tr>
                    <tr>
                        <th>{% trans "Student Name" %}</th>
                        <td>{{ student_data.name }}</td>
                    </tr>
                    <tr>
                        <th>{% trans "Group" %}</th>
                        <td>{{ student_data.group }}</td>
                    </tr>
                    <tr>
                        <th>{% trans "Course" %}</th>
                        <td>{{ student_data.course }}</td>
                    </tr>
                    <tr>
                        <th>{% trans "Price" %}</th>
                        <td>{{ student_data.price }}</td>
                    </tr>
                    <tr>
                        <th>{% trans "For" %}</th>
                        <td>
                            <div class="d-flex gap-2">
                                <select name="month" class="form-select" required>
                                    <option value="">{% trans "--------" %}</option>
                                    {% for month in months %}
                                        <option value="{{ month }}" {% if month == current_month %}selected{% endif %}>{{ month }}</option>
                                    {% endfor %}
                                </select>
                                <select name="year" class="form-select" required>
                                    <option value="">{% trans "--------" %}</option>
                                    {% for year in years %}
                                        <option value="{{ year }}" {% if year == current_year %}selected{% endif %}>{{ year }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <th>{% trans "Status" %}</th>
                        <td>
                            {% if student_data.status %}
                                <ul class="list-unstyled m-0 p-0">
                                    {% for status in student_data.status %}
                                        <li class="d-inline-block me-1 mb-1">
                                            <span class="badge bg-danger" style="font-size: 0.8rem; padding: 0.5em 0.7em;">{{ status }}</span>
                                        </li>
                                    {% endfor %}
                                </ul>
                            {% else %}
                                <span class="text-success">&#10004;</span>
                            {% endif %}
                        </td>
                    </tr>
                </tbody>
            </table>

            <!-- Save Invoice Button -->
            <div class="row justify-content-center">
                <div class="col-md-3">
                    <button type="submit" class="btn btn-success w-100">{% trans "Save" %}</button>
                </div>
            </div>
        </form>
    {% endif %}
</div>
{% endblock %}
