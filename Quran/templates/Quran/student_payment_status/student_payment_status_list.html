{% extends "base.html" %}
{% load i18n %}

{% block title %}{% trans "Payment Status" %}{% endblock %}

{% block content %}
<div class="container">
    <h3 class="d-flex justify-content-center gap-3 mt-4">{% trans "Payment Status" %}</h3>

    <!-- Search + Add -->
    <form action="{% url 'payment_status' %}" method="POST">
        {% csrf_token %}
        <div class="row g-3 align-items-end">
            <!-- School -->
            {% if request.user.is_superuser %}
                <div class="col-md-3">
                    <label class="form-label fw-semibold">{% trans "School" %}</label>
                    <select name="school" class="form-select" required>
                        <option value="">{% trans "--------" %}</option>
                        {% for school in schools %}
                        <option value="{{ school.id }}" {% if school.id == selected_school|add:0 %}selected{% endif %}>
                            {{ school.name }}
                        </option>
                        {% endfor %}
                    </select>
                </div>
            {% endif %}

            <!-- From date -->
            <div class="col-md-3">
                <input type="date" name="date_from" class="form-control" value="{{ from_date|default:today|date:'Y-m-d' }}" max="{{ today|date:'Y-m-d' }}">
            </div>
            
            <!-- To date -->
            <div class="col-md-3">
                <input type="date" name="date_to" class="form-control" value="{{ date_to|default:today|date:'Y-m-d' }}" max="{{ today|date:'Y-m-d' }}">
            </div>

            <!-- Buttons -->
            <div class="col-md-3 d-flex gap-2">
                <!-- Filter Button -->
                <button type="submit" name="action" value="filter" class="btn btn-primary w-100">
                    <i class="bi bi-search me-1"></i> {% trans "Filter Report" %}
                </button>

                <!-- Excel Button -->
                <button type="submit" name="action" value="excel" class="btn btn-success w-100">
                    <i class="bi bi-file-earmark-excel me-1"></i> {% trans "Excel" %}
                </button>
            </div>
        </div>
    </form>

    <!-- Table -->
    <div class="table-responsive-custom mt-4">
        <table class="table table-bordered table-striped full-width-table">
            <thead class="table-light sticky-header">
                <tr>
                    <th>{% trans "#" %}</th>
                    <th>{% trans "Date" %}</th>
                    <th>{% trans "Student Code" %}</th>
                    <th>{% trans "Student Name" %}</th>
                    <th>{% trans "Month" %}</th>
                    <th>{% trans "Year" %}</th>
                    <th>{% trans "Amount" %}</th>
                </tr>
            </thead>
            <tbody>
                {% for item in data %}
                <tr>
                    <td>{{ forloop.counter }}</td>
                    <td>{{ item.date }}</td>
                    <td>{{ item.student_code }}</td>
                    <td>{{ item.student_name }}</td>
                    <td>{{ item.month }}</td>
                    <td>{{ item.year }}</td>
                    <td>{{ item.amount }}</td>
                </tr>
                {% endfor %}

                {% if totals %}
                <tr class="table-secondary fw-bold">
                    <td colspan="6" class="text-center">{% trans "Totals" %}</td>
                    <td>{{ totals.total_amount }}</td>
                </tr>
                {% endif %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}
